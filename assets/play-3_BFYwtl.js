const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BrCdVL5z.js","./Badge-BQoPhukz.js","./ton-vendor-BkcVSvwD.js","./ton-assembly-nn7KYO_c.js","./ton-sandbox-uER9kMRK.js","./Badge-DTFoUNfN.css","./monaco-editor-core-BNZEfIW9.js","./monaco-editor-core-GL-q52Lm.css","./error-codes-B36bHDJL.js","./index-CiNhpJcB.css"])))=>i.map(i=>d[i]);
var Z=Object.defineProperty;var ee=(a,n,e)=>n in a?Z(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e;var I=(a,n,e)=>ee(a,typeof n!="symbol"?n+"":n,e);import{d as w,a as b,j as o,B as te,F as oe,R as M,r as c,u as ne,I as ae,b as se,G as re,T as ie,H as ce,P as le}from"./Badge-BQoPhukz.js";import{_ as ue}from"./monaco-editor-core-BNZEfIW9.js";import{m as de,f as me,u as pe,a as he,n as N,b as xe}from"./useTraceStepper-DteFh8m7.js";import{a as ge}from"./ton-sandbox-uER9kMRK.js";import{S as ye}from"./StatusBadge-CKwXS3FD.js";import fe from"./index-B1-ESCh9.js";import{B as be,d as Ce,u as ve,S as Ee,T as Se}from"./ButtonLoader-BIjsxO-l.js";import"./ton-vendor-BkcVSvwD.js";import"./ton-assembly-nn7KYO_c.js";import"./error-codes-B36bHDJL.js";var R=ge();function ke(a){const n=new b.TupleBuilder;for(const e of a)switch(e.$){case"Integer":n.writeNumber(e.value);break;case"Cell":try{const u=b.Cell.fromHex(e.boc);n.writeCell(u)}catch{console.warn("Invalid cell BoC, skipping:",e.boc)}break;case"Slice":try{const u=b.Cell.fromHex(e.hex);n.writeSlice(u.beginParse())}catch{console.warn("Invalid slice hex, skipping:",e.hex)}break;case"Null":break;default:console.warn("Unsupported stack element type:",e.$)}return n}const we=async(a,n=0,e=[])=>{class u{constructor(y,f){I(this,"address");I(this,"init");this.address=y,this.init=f}async send(y,f,E,S){await y.internal(f,{...E,body:S})}async getAny(y,f,E){const S=ke(E),k=await y.get(f,S.build());return[k.stack,k.vmLogs]}}const l=await R.Blockchain.create();l.verbosity.print=!1,l.verbosity.vmLogs="vm_logs_verbose";const d=await l.treasury("treasure"),s={code:a,data:new b.Cell},m=b.contractAddress(0,s),x=new u(m,s),g=l.openContract(x);await g.send(d.getSender(),{value:b.toNano("10")},new b.Cell);const[v,p]=await g.getAny(n,e);return[v,p]};class Te extends Error{constructor(n){super(n),this.name="TasmCompilationError"}}const _e=async(a,n=[])=>{const e=w.text.parse("playground.tasm",a);if(e.$==="ParseFailure"){const s=e.error.loc,m=s.file+":"+(s.line+1);throw new Te(m+": "+e.error.message)}const[u,l]=w.runtime.compileCellWithMapping(e.instructions),d=de.createMappingInfo(l);try{const[s,m]=await we(u,0,n),x=w.trace.createTraceInfoPerTransaction(m,d,void 0)[0];return{stack:s,vmLogs:m,instructions:e.instructions,code:a,mappingInfo:d,exitCode:void 0,traceInfo:x}}catch(s){if(s instanceof R.GetMethodError){const m=w.trace.createTraceInfoPerTransaction(s.vmLogs,d,void 0)[0],x=me(s.vmLogs,d);return{stack:{items:[],remaining:0},vmLogs:s.vmLogs,instructions:e.instructions,code:a,mappingInfo:d,exitCode:x,traceInfo:m}}throw s}},Ie="_traceViewWrapper_7xotu_1",Ae="_appContainer_7xotu_9",Le="_headerContent_7xotu_19",Pe="_txStatusContainer_7xotu_25",je="_mainActionContainer_7xotu_32",Ne="_mainContent_7xotu_40",Be="_editorContainer_7xotu_72",Me="_executeButton_7xotu_84",Re="_sidebarArea_7xotu_138",h={traceViewWrapper:Ie,appContainer:Ae,headerContent:Le,txStatusContainer:Pe,mainActionContainer:je,mainContent:Ne,editorContainer:Be,executeButton:Me,sidebarArea:Re};function Ge({onClick:a,loading:n}){return o.jsx(te,{onClick:a,disabled:n,className:h.executeButton,title:n?"Executing Assembly Code...":"Execute Assembly Code (Ctrl/Cmd+Enter)","aria-label":n?"Executing assembly code...":"Execute assembly code","aria-describedby":"execution-status","aria-keyshortcuts":"Control+Enter",children:n?o.jsx(be,{children:"Execute"}):o.jsxs(o.Fragment,{children:[o.jsx(oe,{size:16,"aria-hidden":"true"}),"Execute"]})})}const Oe=[{title:"Welcome to Assembly Playground",content:`This tool lets you write and execute TON Assembly (TVM) code step by step.

Perfect for learning TVM instructions and debugging smart contracts!

Press Esc to close this tutorial at any time.`,target:"",placement:"bottom"},{title:"Assembly Code Editor",content:`Here you can write your TVM assembly instructions.

Each line represents one instruction that will be executed by the TVM.

The default code shows basic stack operations - feel free to modify it!`,target:'[class*="mainContent"] > div:first-child',placement:"right"},{title:"Initial Stack Setup",content:`Before executing code, you can set up an initial stack with test values.

This is useful for testing functions that expect specific inputs.`,target:'[class*="stack-viewer"]',placement:"left"},{title:"Add Elements onto the Stack",content:"Click + button to add elements onto the Stack one by one, or click Import button to insert the entire stack from VM logs",target:'[class*="stack-header-actions"]',placement:"left"},{title:"Execute Your Code",content:`I'll automatically execute the code for you to demonstrate the trace functionality.

Click Execute manually or press Ctrl+Enter to run your assembly code.`,target:'[role="toolbar"] button:first-child',placement:"bottom",autoAction:{type:"click",selector:'[role="toolbar"] button:first-child',delay:400}},{title:"Execution Status",content:`The status badge shows if the execution succeeded or failed.

â€¢ Green badge - Successful execution (exit code 0)
â€¢ Red badge - Failed execution (non-zero exit code)

Exit codes help identify what went wrong in the code.`,target:'[role="status"]',placement:"bottom"},{title:"Great! Code Executed",content:`Perfect! The code execution completed successfully.

On the right panel, you can now view the initial stack state before the first instruction execution.`,target:'[class*="mainContent"] > div:last-child',placement:"left"},{title:"Navigate Through Steps",content:`Use the navigation buttons to step through your code execution.

I'll automatically click the 'Next' button to show you how the stack changes.

Watch the stack section below!`,target:'[class*="navigation-controls"]',placement:"left",autoAction:{type:"click",selector:'[data-testid="next-step-button"]',delay:400}},{title:"Gas Usage Tracking",content:`Notice how the gas counter increased!

Each TVM instruction consumes gas (computational cost).

This helps you optimize your smart contracts for efficiency.`,target:'[data-testid="cumulative-gas-counter"]',placement:"left"},{title:"Stack Visualization",content:`Look at the stack section below - see how values changed!

TVM is a stack-based virtual machine. Instructions push/pop values to/from the stack.

Try clicking Next/Prev buttons to see the stack evolve.`,target:'[class*="stack-viewer"]',placement:"left"},{title:"Share Your Code",content:`Use the share button to generate links to your code.

Perfect for collaboration, asking for help, or showcasing your smart contracts!`,target:'[role="toolbar"] button:nth-child(2)',placement:"bottom"},{title:"Ready to Code!",content:`You're all set! You now know how to:

â€¢ Write assembly code
â€¢ Execute and debug step by step
â€¢ Monitor gas usage and stack changes
â€¢ Set up initial test conditions

Try modifying the code or writing your own code.

Happy debugging! ðŸš€`,target:'[role="toolbar"]',placement:"bottom"}],Ve=M.lazy(()=>ue(()=>import("./index-BrCdVL5z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url)),De=`PUSHINT_8 42
PUSHINT_8 100
ADD
PUSHINT_16 200
SUB

NOP
`,B="txtracer-playground-assembly-code",A="txtracer-playground-initial-stack";function Fe(){const[a,n]=c.useState(()=>{const t=Ce();return t||(localStorage.getItem(B)??De)}),[e,u]=c.useState(void 0),[l,d]=c.useState(!1),[s,m]=c.useState(()=>{try{const t=localStorage.getItem(A);return t?JSON.parse(t,(r,i)=>{if(r==="value"&&typeof i=="string"&&i.match(/^-?\d+$/))try{return BigInt(i)}catch{return i}return i}):[]}catch(t){return localStorage.removeItem(A),console.warn("Failed to restore initial stack from localStorage:",t),[]}}),{setError:x,clearError:g}=ne(),v=ve({tutorialKey:"playground-page",autoStart:!0}),p=e?.traceInfo,{selectedStep:C,currentStep:y,currentStack:f,totalSteps:E,canGoPrev:S,canGoNext:k,handlePrev:G,handleNext:O,goToFirstStep:V,goToLastStep:D,findStepByLine:F,highlightLine:U,transitionType:H}=pe(p),W=he(p),$=c.useMemo(()=>p?p.steps.map(t=>({name:t.instructionName,gasCost:N(t)})):[],[p]),z=c.useMemo(()=>{if(!p)return 0;let t=0;for(let r=0;r<C;r++){const i=p.steps[r];i&&(t+=N(i))}return t},[p,C]),T=c.useCallback(async()=>{if(a.trim()){d(!0),g();try{const t=await _e(a,s);u(t),console.log(t.vmLogs)}catch(t){const r=t instanceof Error?t.message:"Unknown error";x(`Failed to execute assembly code: ${r}`),u(void 0)}finally{d(!1)}}},[a,g,s,x]);c.useEffect(()=>{const t=r=>{(r.ctrlKey||r.metaKey)&&r.key==="Enter"&&(r.preventDefault(),l||T())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[T,l]),c.useEffect(()=>{localStorage.setItem(B,a)},[a]),c.useEffect(()=>{try{localStorage.setItem(A,JSON.stringify(s,(t,r)=>typeof r=="bigint"?r.toString():r))}catch(t){console.warn("Failed to save initial stack to localStorage:",t)}},[s]);const K=c.useCallback(t=>{n(t),u(void 0),g()},[g]),Y=c.useCallback(t=>{m(t),u(void 0)},[]),L=(()=>{const t=e?.traceInfo?.steps;if(!t)return{line:void 0,approx:!1};const r=t[C];if(!r||r.loc!==void 0)return{line:void 0,approx:!1};let i=C-1,P=1;for(;i>=0&&t[i]?.loc===void 0;)P++,i--;const j=i>=0?t[i]:void 0,Q=j?.loc?.line!==void 0?j.loc.line+1:void 0,X=P>1;return{line:Q,approx:X}})(),_=c.useMemo(()=>{if(e)return e.exitCode&&e.exitCode.num!==0?"failed":"success"},[e]),J=_!==void 0,q=`Exit code: ${e?.exitCode?.num??0}`;return o.jsxs("div",{className:h.traceViewWrapper,children:[o.jsxs(fe,{pageTitle:"playground",children:[J&&o.jsx("div",{className:h.txStatusContainer,role:"status","aria-live":"polite",children:_&&o.jsx(ye,{type:_,text:q,exitCode:e?.exitCode?.num})}),o.jsx("div",{className:h.headerContent,children:o.jsxs("div",{className:h.mainActionContainer,role:"toolbar","aria-label":"Assembly code actions",children:[o.jsx(Ge,{onClick:()=>void T(),loading:l}),o.jsx(Ee,{value:a})]})})]}),o.jsxs("div",{id:"execution-status",className:"sr-only","aria-live":"polite","aria-atomic":"true",children:[l&&"Executing assembly code...",e&&!l&&"Assembly code executed successfully",e?.exitCode&&e.exitCode.num!==0&&!l&&`Execution completed with exit code ${e.exitCode.num}`]}),o.jsx("div",{className:"sr-only",children:"Press Ctrl+Enter or Cmd+Enter to execute the assembly code"}),o.jsx("main",{className:h.appContainer,role:"main","aria-label":"Assembly code playground",children:o.jsxs("div",{className:h.mainContent,children:[o.jsxs("div",{className:h.editorContainer,children:[o.jsx("h2",{id:"code-editor-heading",className:"sr-only",children:"Assembly Code Editor"}),o.jsx(c.Suspense,{fallback:o.jsx(ae,{message:"Loading Editor...",loading:!0}),children:o.jsx(Ve,{code:a,onChange:K,readOnly:!1,highlightLine:U,lineExecutionData:W,implicitRetLine:L.line,implicitRetLabel:L.approx?"â†µ implicit RET (approximate position)":void 0,shouldCenter:H==="button",exitCode:e?.exitCode,onLineClick:F,language:"tasm"})})]}),o.jsx(xe,{selectedStep:C,totalSteps:E,currentStep:y,currentStack:f,canGoPrev:S,canGoNext:k,onPrev:G,onNext:O,onFirst:V,onLast:D,placeholderMessage:"Ready to execute",instructionDetails:$,cumulativeGas:z,showGas:!0,showStackSetup:!0,initialStack:s,onInitialStackChange:Y,hasExecutionResults:!!e,className:h.sidebarArea})]})}),o.jsx(Se,{steps:Oe,isOpen:v.isOpen,onClose:v.closeTutorial,onComplete:v.completeTutorial})]})}se.createRoot(document.getElementById("root")).render(o.jsx(M.StrictMode,{children:o.jsx(re,{children:o.jsx(ie,{children:o.jsx(ce,{children:o.jsx(le,{loadingMessage:"Loading Playground...",children:o.jsx(Fe,{})})})})})}));
