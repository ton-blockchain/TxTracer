import{j as e,r as h,B as ae,o as Ae,F as Pe,w as Oe,g as Re,e as Se,x as He,k as We,I as Q,y as Ue,z as Je,R as te,a as ze,b as qe,T as Ke,H as Ge,P as Xe}from"./Badge-BV7jRVJK.js";import le from"./index-ryToIbDM.js";import{a as $}from"./index-CGLIbKtS.js";import{C as Z,c as Y,r as Ye,T as Ze,d as me,a as R,O as Te,e as Qe,S as et,E as tt,b as st,A as nt,g as at}from"./ActionsSummary-C9clmZTS.js";import{a as ot,i as it}from"./traceTx-2Do7wL83.js";import{C as pe}from"./TraceSidePanel-D8tuz5c7.js";import{I as lt}from"./InlineLoader-CGowWQeR.js";import"./ton-vendor-BfW9jqPK.js";import"./ton-assembly-CW3W9DLg.js";import"./ton-sandbox-BJJ_Xbr6.js";import"./Tooltip-DXgRcOBE.js";import"./error-codes-B36bHDJL.js";import"./monaco-editor-core-BNZEfIW9.js";const rt=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 21h6"}),e.jsx("path",{d:"M12 17v4"}),e.jsx("path",{d:"M15 9.34V17a2 2 0 0 1-2 2H11a2 2 0 0 1-2-2v-7.66"}),e.jsx("path",{d:"M7.76 8.46A8 8 0 1 1 16.24 8.46"})]}),ct=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"}),e.jsx("path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"}),e.jsx("path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"}),e.jsx("path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"})]}),dt=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),e.jsx("path",{d:"M21 3v5h-5"}),e.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),e.jsx("path",{d:"M8 16H3v5"})]}),mt=()=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20,6 9,17 4,12"})}),ut=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"16,18 22,12 16,6"}),e.jsx("polyline",{points:"8,6 2,12 8,18"})]}),ht=()=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"6,9 12,15 18,9"})}),pt=()=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"18,15 12,9 6,15"})});function q(t,s,n){const a={};let o=t;const c=s.fields;for(let r=0;r<c.length;r++){const l=c[r];try{if(l.type.kind==="simple")if(l.type.type==="address")l.type.optional?a[l.name]=o.loadMaybeAddress():a[l.name]=o.loadAddress();else if(l.type.type==="bool")a[l.name]=o.loadUintBig(1);else if(l.type.type==="uint"&&typeof l.type.format=="number")a[l.name]=o.loadUintBig(l.type.format);else if(l.type.type==="int"&&typeof l.type.format=="number")a[l.name]=o.loadIntBig(l.type.format);else if(l.type.type==="uint"&&typeof l.type.format=="string")l.type.format==="varuint16"?a[l.name]=o.loadVarUintBig(4):l.type.format==="varuint32"?a[l.name]=o.loadVarUintBig(8):l.type.format==="coins"&&(a[l.name]=o.loadCoins());else if(l.type.type==="int"&&typeof l.type.format=="string")l.type.format==="varint16"?a[l.name]=o.loadVarIntBig(4):l.type.format==="varint32"&&(a[l.name]=o.loadVarUintBig(8));else if(l.type.type==="cell"||l.type.type==="string"||l.type.type==="builder")l.type.optional?o.loadUint(1)&&(a[l.name]=o.loadRef()):a[l.name]=o.loadRef();else if(l.type.format==="ref")a[l.name]=o.loadRef();else if(l.type.type==="slice"&&l.type.format==="remainder")a[l.name]=o.asCell().asSlice();else{const p=l.type.type;if(l.type.optional){if(o.loadUint(1)){const v=n.find(f=>f.name===p);v&&(a[l.name]={$:"sub-object",value:q(o,v,n)})}else a[l.name]=null;continue}else{const u=n.find(v=>v.name===p);if(u){a[l.name]={$:"sub-object",value:q(o,u,n)};continue}}console.log("skip",l);return}}catch(p){if(p instanceof Error&&p.message.includes("Invalid address: 3")){o.loadUint(1),r--;continue}if(p instanceof Error&&p.message.includes("is out of bounds")&&o.remainingRefs>0){console.log("retry"),r--,o=o.loadRef().beginParse();continue}console.error(`Error while parsing ${l.name} of ${s.name} at index ${r}: ${p}`)}}return a}const xt="_container_ti76x_1",ft="_field_ti76x_7",_t="_fieldHeader_ti76x_14",jt="_fieldName_ti76x_21",gt="_fieldValue_ti76x_30",bt="_stringValue_ti76x_39",vt="_numberValue_ti76x_50",Nt="_booleanTrue_ti76x_56",Ct="_booleanFalse_ti76x_62",yt="_nullValue_ti76x_68",St="_unknownValue_ti76x_74",Tt="_errorText_ti76x_79",wt="_cellValue_ti76x_86",It="_sliceValue_ti76x_87",Vt="_cellLabel_ti76x_94",kt="_sliceLabel_ti76x_95",$t="_subObject_ti76x_102",Mt="_objectValue_ti76x_109",Bt="_arrayValue_ti76x_117",Lt="_arrayLabel_ti76x_124",Ft="_arrayItem_ti76x_132",Dt="_arrayIndex_ti76x_140",Et="_arrayItemValue_ti76x_147",At="_diffContainer_ti76x_173",Pt="_diffValue_ti76x_179",Ot="_diffOldValue_ti76x_185",Rt="_diffNewValue_ti76x_194",Ht="_unchanged_ti76x_233",M={container:xt,field:ft,fieldHeader:_t,fieldName:jt,fieldValue:gt,stringValue:bt,numberValue:vt,booleanTrue:Nt,booleanFalse:Ct,nullValue:yt,unknownValue:St,errorText:Tt,cellValue:wt,sliceValue:It,cellLabel:Vt,sliceLabel:kt,subObject:$t,objectValue:Mt,arrayValue:Bt,arrayLabel:Lt,arrayItem:Ft,arrayIndex:Dt,arrayItemValue:Et,diffContainer:At,diffValue:Pt,diffOldValue:Ot,diffNewValue:Rt,unchanged:Ht};function ee({data:t,dataBefore:s,contracts:n,depth:a=0,maxDepth:o=10}){if(a>o)return e.jsx("span",{className:M.errorText,children:"Max depth reached"});const c=s!==void 0;return e.jsx("div",{className:M.container,children:Object.entries(t).map(([r,l])=>{const p=s?.[r],u=c&&!ce(p,l);return e.jsxs("div",{className:M.field,children:[e.jsx("div",{className:M.fieldHeader,children:e.jsxs("span",{className:M.fieldName,children:[r,":"]})}),e.jsx("div",{className:M.fieldValue,children:c&&u?e.jsxs("div",{className:M.diffValue,children:[e.jsx("div",{className:M.diffOldValue,children:e.jsx(se,{value:p,contracts:n,depth:a,maxDepth:o})}),e.jsx("div",{className:M.diffNewValue,children:e.jsx(se,{value:l,contracts:n,depth:a,maxDepth:o})})]}):e.jsx("div",{className:c?M.unchanged:void 0,children:e.jsx(se,{value:l,contracts:n,depth:a,maxDepth:o})})})]},r)})})}function se({value:t,contracts:s,depth:n,maxDepth:a}){if(t instanceof $.Address)return e.jsx(Z,{address:t.toString(),contracts:s});if(t instanceof $.Cell)return e.jsx("div",{className:M.cellValue,children:e.jsx(Y,{title:"cell hex",content:t.toBoc().toString("hex")})});if(t instanceof $.Slice)return e.jsx("div",{className:M.sliceValue,children:e.jsx(Y,{title:"slice hex",content:t.asCell().toBoc().toString("hex")})});if(typeof t=="bigint")return e.jsx("span",{className:M.numberValue,children:t.toString()});if(typeof t=="number")return e.jsx("span",{className:M.numberValue,children:t.toString()});if(typeof t=="boolean")return e.jsx("span",{className:t?M.booleanTrue:M.booleanFalse,children:t?"true":"false"});if(typeof t=="string")return e.jsxs("span",{className:M.stringValue,children:['"',t,'"']});if(t==null)return e.jsx("span",{className:M.nullValue,children:"null"});if(t&&typeof t=="object"&&"$"in t&&t.$==="sub-object"&&"value"in t&&t.value){const o=t.value;return e.jsx("div",{className:M.subObject,children:e.jsx(ee,{data:o,contracts:s,depth:n+1,maxDepth:a})})}if(Array.isArray(t))return e.jsxs("div",{className:M.arrayValue,children:[e.jsxs("div",{className:M.arrayLabel,children:["[",t.length," items]"]}),t.map((o,c)=>e.jsxs("div",{className:M.arrayItem,children:[e.jsxs("span",{className:M.arrayIndex,children:["[",c,"]:"]}),e.jsx("div",{className:M.arrayItemValue,children:e.jsx(se,{value:o,contracts:s,depth:n+1,maxDepth:a})})]},c))]});if(typeof t=="object"&&!Array.isArray(t))try{const o=t;return e.jsx("div",{className:M.objectValue,children:e.jsx(ee,{data:o,contracts:s,depth:n+1,maxDepth:a})})}catch{return e.jsx("span",{className:M.unknownValue,children:JSON.stringify(t)})}return e.jsx("span",{className:M.unknownValue,children:"something"})}function ce(t,s){if(t===s)return!0;if(t instanceof $.Address&&s instanceof $.Address)return t.toString()===s.toString();if(t instanceof $.Cell&&s instanceof $.Cell)return t.toBoc().toString("hex")===s.toBoc().toString("hex");if(t instanceof $.Slice&&s instanceof $.Slice)return t.asCell().toBoc().toString("hex")===s.asCell().toBoc().toString("hex");if(typeof t=="bigint"&&typeof s=="bigint")return t===s;if(Array.isArray(t)&&Array.isArray(s))return t.length!==s.length?!1:t.every((n,a)=>ce(n,s[a]));if(typeof t=="object"&&typeof s=="object"&&t!==null&&s!==null){const n=t,a=s,o=Object.keys(n),c=Object.keys(a);return o.length!==c.length?!1:o.every(r=>ce(n[r],a[r]))}return!1}function Wt(){const[t,s]=h.useState(null),[n,a]=h.useState(!1),o=h.useRef(null),c=h.useRef(0),r=h.useCallback(()=>{o.current&&(clearTimeout(o.current),o.current=null)},[]),l=h.useCallback((m,x,g)=>{const y={width:window.innerWidth,height:window.innerHeight},N=10,L=[{placement:"right",x:m.right+N,y:m.top+m.height/2-g/2,score:0},{placement:"left",x:m.left-x-N,y:m.top+m.height/2-g/2,score:0},{placement:"bottom",x:m.left+m.width/2-x/2,y:m.bottom+N,score:0},{placement:"top",x:m.left+m.width/2-x/2,y:m.top-g-N,score:0}];L.forEach(T=>{const J=T.x>=N&&T.x+x<=y.width-N,z=T.y>=N&&T.y+g<=y.height-N;J&&z&&(T.score+=100),T.x<N&&(T.score-=(N-T.x)*2),T.x+x>y.width-N&&(T.score-=(T.x+x-y.width+N)*2),T.y<N&&(T.score-=(N-T.y)*2),T.y+g>y.height-N&&(T.score-=(T.y+g-y.height+N)*2);const W=T.x,K=y.width-(T.x+x),U=T.y,oe=y.height-(T.y+g);T.score+=Math.min(W,K,U,oe)});const w=L.reduce((T,J)=>J.score>T.score?J:T),H=Math.max(N,Math.min(w.x,y.width-x-N)),k=Math.max(N,Math.min(w.y,y.height-g-N));return{x:H,y:k,placement:w.placement}},[]),p=h.useCallback(m=>{r();const x=`tooltip-${++c.current}`;s({...m,id:x})},[r]),u=h.useCallback((m=!1)=>{!m&&n||(r(),o.current=setTimeout(()=>{s(null),a(!1)},0))},[n,r]),v=h.useCallback(()=>{r(),s(null),a(!1)},[r]),f=h.useCallback(m=>{m?(r(),a(!0)):(a(!1),u(!0))},[r,u]);return h.useEffect(()=>()=>{r()},[r]),{tooltip:t,showTooltip:p,hideTooltip:u,forceHideTooltip:v,isTooltipHovered:n,setIsTooltipHovered:f,calculateOptimalPosition:l}}const Ut="_tooltip_b2n1m_1",Jt="_tooltipVisible_b2n1m_18",zt="_content_b2n1m_23",qt="_bridge_b2n1m_28",X={tooltip:Ut,tooltipVisible:Jt,content:zt,bridge:qt};function Kt(t,s,n){switch(n){case"right":return new DOMRect(t.right,Math.min(t.top,s.top)-20,s.left-t.right,Math.max(t.bottom,s.bottom+20)-Math.min(t.top,s.top)+20*2);case"left":return new DOMRect(s.right,Math.min(t.top,s.top)-20,t.left-s.right,Math.max(t.bottom,s.bottom+20)-Math.min(t.top,s.top)+20*2);case"bottom":return new DOMRect(Math.min(t.left,s.left)-20,t.bottom,Math.max(t.right,s.right+20)-Math.min(t.left,s.left)+20*2,s.top-t.bottom);case"top":return new DOMRect(Math.min(t.left,s.left)-20,s.bottom,Math.max(t.right,s.right+20)-Math.min(t.left,s.left)+20*2,t.top-s.bottom)}}function Gt({content:t,triggerRect:s,onMouseEnter:n,onMouseLeave:a,onForceHide:o,calculateOptimalPosition:c}){const r=h.useRef(null),l=h.useRef(null),[p,u]=h.useState({x:0,y:0,placement:"right"}),[v,f]=h.useState(!1),[m,x]=h.useState(null);h.useEffect(()=>{if(!r.current)return;const y=r.current.getBoundingClientRect(),N=c(s,y.width??400,y.height??200);u(N);const L=new DOMRect(N.x,N.y,y.width||400,y.height||200),w=Kt(s,L,N.placement);x(w),f(!0)},[s,c]),h.useEffect(()=>{const y=w=>{r.current&&!r.current.contains(w.target)&&l.current&&!l.current.contains(w.target)&&(o?o():a())},N=w=>{w.key==="Escape"&&(o?o():a())},L=()=>{o?o():a()};return document.addEventListener("mousedown",y),document.addEventListener("keydown",N),window.addEventListener("blur",L),()=>{document.removeEventListener("mousedown",y),document.removeEventListener("keydown",N),window.removeEventListener("blur",L)}},[a,o]);const g=e.jsxs(e.Fragment,{children:[m&&e.jsx("div",{ref:l,className:`${X.bridge} ${X[`bridge--${p.placement}`]}`,style:{left:m.x,top:m.y,width:m.width,height:m.height},onMouseEnter:n,onMouseLeave:a}),e.jsx("div",{ref:r,className:`${X.tooltip} ${X[`tooltip--${p.placement}`]} ${v?X.tooltipVisible:""}`,style:{left:p.x,top:p.y,pointerEvents:"auto"},onMouseEnter:n,onMouseLeave:a,children:e.jsx("div",{className:X.content,children:t})})]});return Ye.createPortal(g,document.body)}const Xt="_container_1cn0r_1",Yt="_tabsContainer_1cn0r_7",Zt="_tab_1cn0r_7",Qt="_tabActive_1cn0r_34",es="_treeContainer_1cn0r_56",ts="_treeWrapper_1cn0r_63",ss="_edgeStyle_1cn0r_82",ns="_edgeStyleWithInit_1cn0r_87",as="_edgeStyleBounced_1cn0r_91",os="_edgeTextTitle_1cn0r_95",is="_edgeText_1cn0r_95",ls="_edgeTextContent_1cn0r_118",rs="_tooltipContent_1cn0r_180",cs="_tooltipField_1cn0r_186",ds="_tooltipFieldLabel_1cn0r_192",ms="_tooltipFieldValue_1cn0r_199",us="_tooltipSubValue_1cn0r_208",hs="_contractStateData_1cn0r_215",ps="_foreignObjectContainer_1cn0r_223",xs="_iconSvg_1cn0r_230",fs="_transactionDetails_1cn0r_241",_s="_contractDetails_1cn0r_245",js="_topText_1cn0r_258",gs="_bottonText_1cn0r_264",C={container:Xt,tabsContainer:Yt,tab:Zt,tabActive:Qt,treeContainer:es,treeWrapper:ts,edgeStyle:ss,edgeStyleWithInit:ns,edgeStyleBounced:as,edgeTextTitle:os,edgeText:is,edgeTextContent:ls,tooltipContent:rs,tooltipField:cs,tooltipFieldLabel:ds,tooltipFieldValue:ms,tooltipSubValue:us,contractStateData:hs,foreignObjectContainer:ps,iconSvg:xs,transactionDetails:fs,contractDetails:_s,topText:js,bottonText:gs},xe=(t,s)=>{if(!t)return"unknown";const n=t.toString(),a=s.get(n);if(a){const o=a.displayName;if(o!=="Unknown Contract")return o}return n.slice(0,4)+"..."+n.slice(n.length-4)},bs=t=>{if(!t)return"unknown";const s=t.toString();return s.slice(0,6)+"..."+s.slice(s.length-6)},ne=(t,s)=>t?.types?.find(n=>n.name===`${s}$Data`),we=t=>{switch(t){case"ExtendedShardedJettonWallet":return"JettonWalletSharded";case"ExtendedShardedJettonMinter":return"JettonMinterSharded";case"ExtendedJettonWallet":return"JettonWallet";case"ExtendedJettonMinter":return"JettonMinter";case"ExtendedLPJettonWallet":return"LPJettonWallet";case"ExtendedLPJettonMinter":return"LPJettonMinter"}return t},vs=(t,s)=>{if(!t.meta?.abi){if(t.kind==="treasury")return;for(const[,n]of s){if(!n.meta?.abi)continue;const a=fe(t,n.meta?.abi);if(a)return a}return}return fe(t,t.meta?.abi)},fe=(t,s)=>{if(t.kind==="treasury")return;const n=t.stateInit?.data;if(n){const a=$.Cell.fromHex(n.toBoc().toString("hex")),o=ne(s,t.displayName);if(o)return q(a.asSlice(),o,s.types??[]);const c=we(t.displayName),r=ne(s,c);if(r)return q(a.asSlice(),r,s.types??[])}},_e=(t,s)=>{if(!(!t||s.kind==="treasury"))try{const n=$.Cell.fromHex(t),a=ne(s.meta?.abi??void 0,s.displayName);if(a)return q(n.asSlice(),a,s.meta?.abi?.types??[]);const o=we(s.displayName),c=ne(s.meta?.abi??void 0,o);if(c)return q(n.asSlice(),c,s.meta?.abi?.types??[])}catch(n){console.error("Error parsing contract state from string:",n)}};function Ns({data:t}){return e.jsxs("div",{className:C.tooltipContent,children:[e.jsxs("div",{className:C.tooltipField,children:[e.jsx("div",{className:C.tooltipFieldLabel,children:"From Address"}),e.jsx("div",{className:C.tooltipFieldValue,children:t.fromAddress})]}),e.jsxs("div",{className:C.tooltipField,children:[e.jsx("div",{className:C.tooltipFieldLabel,children:"Compute Phase"}),e.jsxs("div",{className:C.tooltipFieldValue,children:[t.computePhase.success?"Success":"Failed",t.computePhase.exitCode!==void 0&&t.computePhase.exitCode!==0&&e.jsxs("span",{children:[" ","(Exit:"," ",t.computePhase.exitCode,")"]}),t.computePhase.gasUsed&&e.jsxs("div",{className:C.tooltipSubValue,children:["Gas Used: ",t.computePhase.gasUsed.toString()]}),t.computePhase.vmSteps!==void 0&&e.jsxs("div",{className:C.tooltipSubValue,children:["VM Steps: ",t.computePhase.vmSteps.toString()]})]})]}),e.jsxs("div",{className:C.tooltipField,children:[e.jsx("div",{className:C.tooltipFieldLabel,children:"Money"}),e.jsxs("div",{className:C.tooltipFieldValue,children:[e.jsxs("div",{children:["Sent Total: ",R(t.sentTotal)]}),e.jsxs("div",{className:C.tooltipSubValue,children:["Total Fees: ",R(t.fees.totalFees)]}),t.fees.gasFees&&e.jsxs("div",{className:C.tooltipSubValue,children:["Gas Fees: ",R(t.fees.gasFees)]})]})]})]})}function Cs({data:t,contracts:s}){return e.jsx("div",{className:C.tooltipContent,children:e.jsxs("div",{className:C.tooltipField,children:[e.jsx("div",{className:C.tooltipFieldLabel,children:"Contract State"}),e.jsx("div",{className:C.tooltipFieldValue,children:e.jsx("div",{className:C.contractStateData,children:t.contractState&&e.jsx(ee,{data:t.contractState,dataBefore:t.contractStateBefore,contracts:s})})})]})})}function ys({testData:t}){const{tooltip:s,showTooltip:n,hideTooltip:a,forceHideTooltip:o,setIsTooltipHovered:c,calculateOptimalPosition:r}=Wt(),[l,p]=h.useState(null),[u,v]=h.useState(null),[f,m]=h.useState(null),x=h.useRef(null),g=t.contracts,y=h.useMemo(()=>t.transactions.filter(d=>!d.parent).sort((d,S)=>Number(d.transaction.lt-S.transaction.lt)),[t.transactions]),N=d=>{const S=[d],b=V=>{V.children.forEach(P=>{S.push(P),b(P)})};return b(d),S},L=h.useMemo(()=>{if(!f)return t.transactions;const d=y.find(S=>S.transaction.lt.toString()===f);return d?N(d):t.transactions},[t.transactions,f,y]),w=d=>{m(d),p(null),v(null)},H=d=>{const S=(F,E=0)=>!F.children||F.children.length===0?E:Math.max(...F.children.map(O=>S(O,E+1))),b=F=>!F.children||F.children.length===0?1:F.children.reduce((E,O)=>E+b(O),0),V=b(d),P=S(d),D=V<=2?V*80+20:V*100+100;return{height:Math.max(100,D),width:Math.max(800,P*200+200)}},k=h.useMemo(()=>{const d=new Map;for(let S=0;S<L.length;S++){const b=L[S];d.set(b.transaction.lt.toString(),b)}return d},[L]),T=d=>{const S=k.get(d);S&&(l?.transaction.lt.toString()===d?(p(null),v(null)):(p(S),v(null)))},J=d=>{const S=g.get(d);S&&(u?.address.toString()===d?v(null):v(S))},z=(d,S)=>{const b=d.currentTarget.getBoundingClientRect();x.current=b;const V=S.computeInfo,P={success:V!=="skipped"?V.success:!0,exitCode:V!=="skipped"?V.exitCode:void 0,gasUsed:V!=="skipped"?V.gasUsed:void 0,vmSteps:V!=="skipped"?V.vmSteps:void 0},D={gasFees:V!=="skipped"?V.gasFees:void 0,totalFees:S.money.totalFees},F=S.transaction.inMessage?.info?.src,O={fromAddress:F?bs(F):"unknown",computePhase:P,fees:D,sentTotal:S.money.sentTotal};n({x:b.left,y:b.top,content:e.jsx(Ns,{data:O})})},W=(d,S)=>{if(!S?.address)return;const b=d.currentTarget.getBoundingClientRect();x.current=b;const V=g.get(S.address.toString());if(!V)return;const P=vs(V,g),D=t.changes.find(O=>O.address===V.address.toString()&&S.transaction.lt.toString()===O.lt),F=D?.before?_e(D.before,V):void 0,E=D?.after?_e(D.after,V):P;if(E||F){const O={contractState:E,contractStateBefore:F,contractData:V};n({x:b.left,y:b.top,content:e.jsx(Cs,{data:O,contracts:g})})}},K=h.useMemo(()=>{const d=f?y.filter(b=>b.transaction.lt.toString()===f):y,S=b=>{const V=b.address,P=xe(V,g),D=b.transaction.description.type==="generic"?b.transaction.description.computePhase:null,F=b.transaction.inMessage,E=F?.init?.code!==void 0,O=F?.info?.type==="internal"?F.info.bounced:!1,$e=D?.type==="vm"?D.success:!0,Me=D?.type==="vm"?D.exitCode===0?b.transaction.description.type==="generic"?b.transaction.description.actionPhase?.resultCode??0:0:D.exitCode:void 0,Be=b.transaction.inMessage?.info?.type==="internal"?b.transaction.inMessage?.info.value?.coins:void 0,ue=b.opcode?.toString(16),Le=me(b,g)?.name,Fe=V?g.get(V.toString())?.letter??"?":"?",he=b.transaction.lt.toString(),De=l?.transaction.lt.toString()===he;return{name:`${P}`,attributes:{from:b.transaction.inMessage?.info?.src?.toString()??"unknown",to:b.transaction.inMessage?.info?.dest?.toString()??"unknown",lt:he,success:$e?"✓":"✗",exitCode:Me?.toString()??"0",value:R(Be),opcode:Le??(ue?`0x${ue}`:void 0)??"empty opcode",outMsgs:b.transaction.outMessagesCount.toString(),withInitCode:E,isBounced:O,contractLetter:Fe,isSelected:De},children:b.children.map(Ee=>S(Ee))}};return d.length>0?{name:"",attributes:{isRoot:"true"},children:d.map(b=>S(b))}:{name:"No transactions",attributes:{},children:[]}},[y,g,l,f]),U=({nodeDatum:d,toggleNode:S})=>{if(d.attributes?.isRoot==="true")return e.jsxs("g",{children:[e.jsx("circle",{r:15,fill:"var(--color-background-secondary)",stroke:"var(--color-text-primary)",strokeWidth:1.5}),e.jsx("text",{fill:"var(--color-text-primary)",strokeWidth:"0",x:"0",y:"5",fontSize:"14",fontWeight:"bold",textAnchor:"middle",children:"BL"})]});const b=d.attributes?.opcode??"empty opcode",V=!Number.isNaN(Number.parseInt(b)),P=d.attributes?.isSelected,D=d.attributes?.lt,F=k.get(D);return e.jsxs("g",{children:[e.jsx("foreignObject",{width:"4",height:"6",x:"-20",y:"-3",className:C.foreignObjectContainer,children:e.jsx("svg",{width:"4",height:"6",viewBox:"0 0 4 5",xmlns:"http://www.w3.org/2000/svg",className:C.iconSvg,children:e.jsx("path",{d:"M0.400044 0.549983C0.648572 0.218612 1.11867 0.151455 1.45004 0.399983L3.45004 1.89998C3.6389 2.04162 3.75004 2.26392 3.75004 2.49998C3.75004 2.73605 3.6389 2.95834 3.45004 3.09998L1.45004 4.59998C1.11867 4.84851 0.648572 4.78135 0.400044 4.44998C0.151516 4.11861 0.218673 3.64851 0.550044 3.39998L1.75004 2.49998L0.550044 1.59998C0.218673 1.35145 0.151516 0.881354 0.400044 0.549983Z",fill:"var(--color-text-tertiary)"})})}),e.jsx("circle",{r:15,fill:P?"var(--color-text-primary)":d.attributes?.success==="✓"?"var(--color-background-secondary)":"#ef4444",stroke:"var(--color-text-primary)",strokeWidth:1.5,onClick:()=>T(D),onMouseEnter:E=>{F?.address&&W(E,F)},onMouseLeave:()=>{a()},style:{cursor:"pointer"}}),e.jsx("text",{fill:P?"var(--color-background-primary)":"var(--color-text-primary)",strokeWidth:"0",x:"0",y:"5",fontSize:"14",fontWeight:"bold",textAnchor:"middle",style:{pointerEvents:"none"},children:d.attributes?.contractLetter}),e.jsx("foreignObject",{width:"150",height:"100",x:"-180",y:"-40",children:e.jsxs("div",{className:C.edgeText,onMouseEnter:E=>{F&&z(E,F)},onMouseLeave:()=>{a()},children:[e.jsxs("div",{className:C.topText,children:[e.jsx("p",{className:C.edgeTextTitle,children:d.name}),d.attributes?.value&&e.jsx("p",{className:C.edgeTextContent,children:d.attributes.value})]}),e.jsxs("div",{className:C.bottonText,children:[e.jsx("p",{className:C.edgeTextContent,children:V?e.jsxs(e.Fragment,{children:["Opcode: ",b]}):b}),d.attributes?.exitCode&&d.attributes?.exitCode!=="0"&&e.jsxs("p",{className:C.edgeTextContent,children:["Exit: ",d.attributes?.exitCode," | Success:"," ",d.attributes?.success==="✓"?"true":"false"]})]})]})})]})},oe=({target:d},S)=>{const b=d.data.attributes;return b&&b?.withInitCode?C.edgeStyle+` ${C.edgeStyleWithInit}`:b&&b?.isBounced?C.edgeStyle+` ${C.edgeStyleBounced}`:C.edgeStyle},ie=H(K);return e.jsxs("div",{className:C.container,children:[y.length>1&&e.jsxs("div",{className:C.tabsContainer,children:[e.jsx("button",{className:`${C.tab} ${f?"":C.tabActive}`,onClick:()=>w(null),children:"All"}),y.map((d,S)=>{const b=xe(d.address,g),V=f===d.transaction.lt.toString();return e.jsxs("button",{className:`${C.tab} ${V?C.tabActive:""}`,onClick:()=>w(d.transaction.lt.toString()),children:["#",S+1,": ",b]},d.transaction.lt.toString())})]}),e.jsx("div",{className:C.treeContainer,style:{height:`${ie.height}px`},children:e.jsxs("div",{className:C.treeWrapper,style:{width:`${ie.width}px`},children:[e.jsx(Ze,{data:K,orientation:"horizontal",pathFunc:d=>{const S=d.target.data.attributes??{};return S.isFirst?"M".concat(d.source.y.toString(),",").concat(d.source.x.toString(),"V").concat((d.target.x+10).toString(),"a10 10 0 0 1 10 -10H").concat((d.target.y-18).toString()):S.isLast?"M".concat(d.source.y.toString(),",").concat(d.source.x.toString(),"V").concat((d.target.x-10).toString(),"a10 10 0 0 0 10 10H").concat((d.target.y-18).toString()):"M".concat(d.source.y.toString(),",").concat(d.source.x.toString(),"V").concat(d.target.x.toString(),"H").concat((d.target.y-18).toString())},nodeSize:{x:200,y:120},separation:{siblings:.7,nonSiblings:1},renderCustomNodeElement:U,pathClassFunc:oe,translate:{x:50,y:ie.height/2},zoom:1,enableLegacyTransitions:!1,collapsible:!1,zoomable:!1,draggable:!1,pannable:!1,scaleExtent:{min:1,max:1}}),s&&x.current&&e.jsx(Gt,{content:s.content,triggerRect:x.current,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),onForceHide:o,calculateOptimalPosition:r})]})}),l&&e.jsx("div",{className:C.transactionDetails,children:e.jsx($n,{tx:l,testData:t,contracts:g,onContractClick:J})}),u&&e.jsx("div",{className:C.contractDetails,children:e.jsx(ln,{contract:u,contracts:g,tests:[t],isDeployed:!0})})]})}const Ss="_container_2lhva_1",Ts="_mainInformation_2lhva_4",ws="_contractChipHeader_2lhva_15",Is="_mainInformationRows_2lhva_19",Vs="_mainInformationRowTitle_2lhva_31",ks="_mainInformationFooter_2lhva_35",$s="_mainInformationStatus_2lhva_39",Ms="_active_2lhva_56",Bs="_inactive_2lhva_60",Ls="_frozen_2lhva_64",Fs="_detailsInformation_2lhva_68",Ds="_tabsContainer_2lhva_78",Es="_tab_2lhva_78",As="_tabContent_2lhva_102",Ps="_codeSection_2lhva_106",Os="_stateSection_2lhva_112",Rs="_parsedStateInitHeader_2lhva_118",Hs="_parsedStateInit_2lhva_118",Ws="_txTableHeader_2lhva_270",Us="_txTableHeaderCell_2lhva_278",Js="_txTableHeaderCellValue_2lhva_284",zs="_txTableLine_2lhva_288",qs="_txTableCell_2lhva_302",Ks="_txTableCellOpcode_2lhva_307",Gs="_externalInLabel_2lhva_318",Xs="_txTableCellValue_2lhva_323",Ys="_inMessage_2lhva_328",Zs="_addressShort_2lhva_340",Qs="_noTransactionsMessage_2lhva_345",en="_moreTransactionsMessage_2lhva_351",_={container:Ss,mainInformation:Ts,contractChipHeader:ws,mainInformationRows:Is,mainInformationRowTitle:Vs,mainInformationFooter:ks,mainInformationStatus:$s,active:Ms,inactive:Bs,frozen:Ls,detailsInformation:Fs,tabsContainer:Ds,tab:Es,tabContent:As,codeSection:Ps,stateSection:Os,parsedStateInitHeader:Rs,parsedStateInit:Hs,txTableHeader:Ws,txTableHeaderCell:Us,txTableHeaderCellValue:Js,txTableLine:zs,txTableCell:qs,txTableCellOpcode:Ks,externalInLabel:Gs,txTableCellValue:Xs,inMessage:Ys,addressShort:Zs,noTransactionsMessage:Qs,moreTransactionsMessage:en};function tn(t,s){return t.flatMap(n=>n.transactions.filter(a=>a.address?a.address.toString()===s.address.toString():!1))}const je=(t,s=30)=>{if(t.length<=s)return e.jsx(e.Fragment,{children:t});const n=Math.floor(s/2),a=t.substring(0,n),o=t.substring(t.length-n);return e.jsxs("span",{title:t,className:_.truncatedMiddle,children:[a,e.jsx("span",{className:_.ellipsis,children:"…"}),o]})};function sn(t,s){if(!t)return e.jsx("span",{className:_.addressShort,children:"—"});if(t.info.type==="internal"){const n=t.info.src;return e.jsx("div",{className:_.inMessage,children:s?e.jsx(e.Fragment,{children:e.jsx(Z,{address:n.toString(),contracts:s})}):e.jsx(e.Fragment,{children:e.jsx("span",{className:_.addressShort,children:je(n.toString(),10)})})})}if(t.info.type==="external-in"){const n=t.info.src;return e.jsx("div",{className:_.inMessage,children:s?e.jsx(e.Fragment,{children:e.jsx(Z,{address:n?.toString(),contracts:s})}):e.jsx(e.Fragment,{children:e.jsx("span",{className:_.addressShort,children:je(n?.toString()??"unknown",10)})})})}return e.jsx("span",{className:_.addressShort,children:"External"})}function ge(t,s){return t.meta?.abi?.types?.find(n=>n.name===`${s}$Data`)}function nn(t){switch(t){case"ExtendedShardedJettonWallet":return"JettonWalletSharded";case"ExtendedShardedJettonMinter":return"JettonMinterSharded";case"ExtendedJettonWallet":return"JettonWallet";case"ExtendedJettonMinter":return"JettonMinter";case"ExtendedLPJettonWallet":return"LPJettonWallet";case"ExtendedLPJettonMinter":return"LPJettonMinter"}return t}function an(t,s){if(t.meta?.abi===void 0){for(const[,n]of s){const a=be(n);if(a)return a}return}return be(t)}function be(t){if(t.kind==="treasury")return;const s=t.stateInit?.data;if(s){const n=$.Cell.fromHex(s.toBoc().toString("hex")),a=ge(t,t.displayName);if(a)return console.log(a),q(n.asSlice(),a,t.meta?.abi?.types??[]);const o=nn(t.displayName),c=ge(t,o);if(c)return console.log(c),q(n.asSlice(),c,t.meta?.abi?.types??[]);console.log(`no abi data for ${o}`,t.meta?.abi)}}function on({tx:t,contracts:s}){const n=t.opcode,a=me(t,s),o=t.transaction.inMessage,c=o?.info?.type==="internal"?o?.info.value?.coins:void 0,r=o?.info?.type==="external-in";return e.jsxs("div",{className:_.txTableLine,children:[e.jsxs("div",{className:_.txTableCellOpcode,children:[e.jsx(Te,{opcode:n,abiName:a?.name}),r&&e.jsx("span",{className:_.externalInLabel,children:" (external-in)"})]}),e.jsx("div",{className:_.txTableCell,children:sn(o,s)}),e.jsx("div",{className:`${_.txTableCell} ${_.txTableCellValue}`,children:R(c)})]})}function ln({contract:t,contracts:s,tests:n,isDeployed:a}){const[o,c]=h.useState("history"),r=t.address.toString(),l=R(t.account.account?.storage?.balance?.coins),p=(t.meta?.treasurySeed?"Treasury":t.displayName)??"Unknown contract",u=t.account.account?.storage?.state?.type??"unknown",v=w=>{switch(w){case"active":return`${_.mainInformationStatus} ${_.active}`;case"frozen":return`${_.mainInformationStatus} ${_.frozen}`;case"uninit":case"unknown":default:return`${_.mainInformationStatus} ${_.inactive}`}},f=an(t,s),m=tn(n,t),x=t.stateInit?.code?ot.print(it.decompileCell(t.stateInit?.code)):"",g=t.stateInit?.code?.toBoc()?.toString("hex")??"",y=t.stateInit?.data?.toBoc()?.toString("hex")??"",N=t.stateInit?.data?.toString()??"",L=()=>f?e.jsx(ee,{data:f,contracts:s}):null;return e.jsxs("div",{className:_.container,children:[e.jsxs("div",{className:_.mainInformation,children:[e.jsx("div",{className:_.contractChipHeader,children:e.jsx(Z,{address:r,contracts:s})}),e.jsxs("div",{className:_.mainInformationRows,children:[e.jsx("div",{className:_.mainInformationRowTitle,children:"Address"}),e.jsx("div",{children:r}),e.jsx("div",{className:_.mainInformationRowTitle,children:"Balance"}),e.jsx("div",{children:l}),e.jsx("div",{className:_.mainInformationRowTitle,children:"Contract type"}),e.jsx("div",{children:p})]}),e.jsx("div",{className:_.mainInformationFooter,children:e.jsx("div",{className:v(u),children:u})})]}),e.jsxs("div",{className:_.detailsInformation,children:[e.jsxs("div",{className:_.tabsContainer,children:[e.jsx("div",{className:`${_.tab} ${o==="history"?_.active:""}`,onClick:()=>c("history"),onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),c("history"))},role:"button",tabIndex:0,children:"History"}),e.jsx("div",{className:`${_.tab} ${o==="code"?_.active:""}`,onClick:()=>c("code"),onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),c("code"))},role:"button",tabIndex:0,children:"Code"}),e.jsx("div",{className:`${_.tab} ${o==="state-init"?_.active:""}`,onClick:()=>c("state-init"),onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),c("state-init"))},role:"button",tabIndex:0,children:"State Init"})]}),e.jsxs("div",{className:_.tabContent,children:[o==="history"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:_.txTableHeader,children:[e.jsx("div",{className:_.txTableHeaderCell,children:"Operation"}),e.jsx("div",{className:_.txTableHeaderCell,children:"From"}),e.jsx("div",{className:`${_.txTableHeaderCell} ${_.txTableHeaderCellValue}`,children:"Value"})]}),m.length>0?m.map((w,H)=>e.jsx(on,{tx:w,contracts:s},H)):e.jsx("div",{className:_.txTableLine,children:e.jsx("div",{className:`${_.txTableCell} ${_.noTransactionsMessage}`,children:"No transactions found"})}),m.length>10&&e.jsx("div",{className:_.txTableLine,children:e.jsxs("div",{className:`${_.txTableCell} ${_.moreTransactionsMessage}`,children:["+",m.length-10," more transactions"]})})]}),o==="code"&&e.jsxs("div",{className:_.codeSection,children:[e.jsx(Y,{title:"Assembly Code",content:x,variant:"assembly",placeholder:"No assembly code available"}),e.jsx(Y,{title:"Hex",content:g,variant:"hex",placeholder:"No hex code available"})]}),o==="state-init"&&e.jsxs("div",{className:_.stateSection,children:[f&&e.jsxs("div",{children:[e.jsx("div",{className:_.parsedStateInitHeader,children:"Parsed Data"}),e.jsx("div",{className:_.parsedStateInit,children:L()})]}),e.jsx(Y,{title:"Data Hex",content:y,variant:"hex",placeholder:"No init data available"}),e.jsx(Y,{title:"Data Cells",content:N,variant:"hex",placeholder:"No init data available"})]})]})]})]})}const rn="_transactionDetailsContainer_u10sq_1",cn="_detailRow_u10sq_9",dn="_detailLabel_u10sq_19",mn="_detailValue_u10sq_34",un="_timestampValue_u10sq_43",hn="_timestampDetailSecondary_u10sq_47",pn="_labeledSectionRow_u10sq_51",xn="_labeledSectionTitle_u10sq_60",fn="_labeledSectionContent_u10sq_75",_n="_multiColumnRow_u10sq_89",jn="_multiColumnItem_u10sq_96",gn="_multiColumnItemTitle_u10sq_116",bn="_multiColumnItemValue_u10sq_123",vn="_multiColumnItemValueWithRows_u10sq_132",Nn="_booleanTrue_u10sq_136",Cn="_booleanFalse_u10sq_141",yn="_numberValue_u10sq_146",Sn="_parsedDataContent_u10sq_200",Tn="_traceButtonContainer_u10sq_204",wn="_traceButton_u10sq_204",In="_traceViewerContainer_u10sq_229",Vn="_actionsToggleButton_u10sq_233",kn="_actionsToggleText_u10sq_250",i={transactionDetailsContainer:rn,detailRow:cn,detailLabel:dn,detailValue:mn,timestampValue:un,timestampDetailSecondary:hn,labeledSectionRow:pn,labeledSectionTitle:xn,labeledSectionContent:fn,multiColumnRow:_n,multiColumnItem:jn,multiColumnItemTitle:gn,multiColumnItemValue:bn,multiColumnItemValueWithRows:vn,booleanTrue:Nn,booleanFalse:Cn,numberValue:yn,parsedDataContent:Sn,traceButtonContainer:Tn,traceButton:wn,traceViewerContainer:In,actionsToggleButton:Vn,actionsToggleText:kn},ve=(t,s,n)=>t?e.jsx(Z,{address:t.toString(),contracts:s,onContractClick:n}):e.jsx(Z,{address:void 0,contracts:s,onContractClick:n}),Ne=(t,s=!0)=>{if(t===void 0)return"—";const n=typeof t=="string"?new Date(t):new Date(t*1e3),a=g=>g.toString().padStart(2,"0"),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=n.getDate(),r=n.getMonth(),l=r+1,p=n.getFullYear(),u=n.getHours(),v=n.getMinutes(),f=n.getSeconds(),m=`${a(c)}.${a(l)}.${p}, ${a(u)}:${a(v)}:${a(f)}`,x=`${a(c)} ${o[r]}, ${a(u)}:${a(v)}`;return e.jsxs(e.Fragment,{children:[m,s&&e.jsxs("span",{className:i.timestampDetailSecondary,children:[" — ",x]})]})};function $n({tx:t,contracts:s,onContractClick:n,testData:a}){const[o,c]=h.useState(!1),[r,l]=h.useState(!1);if(t.transaction.description.type!=="generic")throw new Error("TxTracer doesn't support non-generic transaction. Given type: "+t.transaction.description.type);const p=t.computeInfo,u=me(t,s);let v;const f=s.get(t.address?.toString()??""),m=t.transaction.inMessage?.body?.asSlice();m&&u&&(m.remainingBits>=32&&m.loadUint(32),v=q(m,u,f?.meta?.abi?.types??[]));const x=H=>e.jsx("span",{className:H?i.booleanTrue:i.booleanFalse,children:H?"Yes":"No"}),g=t.computeInfo!=="skipped"&&!!t.fields.vmLogs,y=t.computeInfo!=="skipped"&&t.computeInfo.success,N=t.transaction.inMessage,L=t.money,w=Qe(t,a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:i.transactionDetailsContainer,children:[g&&e.jsx("div",{className:i.traceButtonContainer,children:e.jsx(ae,{variant:"primary",size:"sm",onClick:()=>c(!o),className:i.traceButton,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{size:14}),"Close"]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{size:14}),"Retrace"]})})}),e.jsxs("div",{className:i.detailRow,children:[e.jsx("div",{className:i.detailLabel,children:"Message Route"}),e.jsxs("div",{className:i.detailValue,children:[ve(t.transaction.inMessage?.info?.src,s,n)," → ",ve(t.transaction.inMessage?.info?.dest,s,n)]})]}),N&&N.info.type==="internal"&&e.jsxs("div",{className:i.labeledSectionRow,children:[e.jsx("div",{className:i.labeledSectionTitle,children:"In Message"}),e.jsx("div",{className:i.labeledSectionContent,children:e.jsxs("div",{className:i.multiColumnRow,children:[e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Value"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.currencyValue}`,children:R(N.info.value.coins)})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Send Mode"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.numberValue}`,children:e.jsx(et,{mode:w})})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"IHR Disabled"}),e.jsx("div",{className:i.multiColumnItemValue,children:x(N.info.ihrDisabled)})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Bounced"}),e.jsx("div",{className:i.multiColumnItemValue,children:x(N.info.bounced)})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Bounce"}),e.jsx("div",{className:i.multiColumnItemValue,children:x(N.info.bounce)})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Created At"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.timestampValue}`,children:Ne(N.info.createdAt,!1)})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Created Lt"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.numberValue}`,children:N.info.createdLt})]})]})})]}),e.jsxs("div",{className:i.labeledSectionRow,children:[e.jsx("div",{className:i.labeledSectionTitle,children:"Message Data"}),e.jsxs("div",{className:i.labeledSectionContent,children:[e.jsx("div",{className:i.multiColumnRow,children:e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Opcode"}),e.jsx("div",{className:i.multiColumnItemValue,children:e.jsx(Te,{opcode:t.opcode,abiName:u?.name})})]})}),v&&e.jsxs("div",{className:`${i.multiColumnItemValue} ${i.multiColumnItemValueWithRows}`,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Parsed Data:"}),e.jsx("div",{className:i.parsedDataContent,children:e.jsx(ee,{data:v,contracts:s})})]})]})]}),e.jsxs("div",{className:i.labeledSectionRow,children:[e.jsx("div",{className:i.labeledSectionTitle,children:"Fees & Sent"}),e.jsx("div",{className:i.labeledSectionContent,children:e.jsxs("div",{className:i.multiColumnRow,children:[e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Amount Sent (Total)"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.currencyValue}`,children:R(L.sentTotal)})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Total Fee"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.currencyValue}`,children:R(L.totalFees)})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Gas Fee"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.gasValue} ${i.currencyValue}`,children:t.computeInfo!=="skipped"?R(t.computeInfo.gasFees):"N/A"})]}),t.transaction.inMessage?.info?.type==="internal"&&e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Forward Fee"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.gasValue} ${i.currencyValue}`,children:R(L.forwardFee)})]})]})})]}),e.jsxs("div",{className:i.labeledSectionRow,children:[e.jsx("div",{className:i.labeledSectionTitle,children:"Compute Phase"}),e.jsx("div",{className:i.labeledSectionContent,children:p==="skipped"?e.jsx("div",{className:i.multiColumnItemValue,children:"Skipped"}):e.jsxs("div",{className:i.multiColumnRow,children:[e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Success"}),e.jsx("div",{className:i.multiColumnItemValue,children:x(p?.success??!1)})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Exit Code"}),e.jsx("div",{className:i.multiColumnItemValue,children:e.jsx(tt,{exitCode:p?.exitCode,abi:f?.meta?.abi})})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"VM Steps"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.numberValue}`,children:p?.vmSteps})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Gas Used"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.gasValue}`,children:p?.gasUsed})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Gas Fee"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${i.gasValue}`,children:R(p?.gasFees)})]})]})})]}),e.jsxs("div",{className:i.labeledSectionRow,children:[e.jsx("div",{className:i.labeledSectionTitle,children:"Action Phase"}),e.jsx("div",{className:i.labeledSectionContent,children:e.jsxs("div",{className:i.multiColumnRow,children:[e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Success"}),e.jsx("div",{className:`${i.multiColumnItemValue} ${y?i.booleanTrue:i.booleanFalse}`,children:x(y)})]}),e.jsxs("div",{className:i.multiColumnItem,children:[e.jsx("div",{className:i.multiColumnItemTitle,children:"Total Actions"}),e.jsxs("div",{className:`${i.multiColumnItemValue} ${i.numberValue}`,children:[st(t.outActions.length),t.outActions.length>0&&e.jsxs("button",{onClick:()=>l(!r),className:i.actionsToggleButton,"aria-label":r?"Hide actions":"Show actions",children:[r?e.jsx(Oe,{size:14}):e.jsx(Re,{size:14}),e.jsx("span",{className:i.actionsToggleText,children:r?"Hide":"Show"})]})]})]})]})})]}),r&&t.outActions.length>0&&e.jsxs("div",{className:i.labeledSectionRow,children:[e.jsx("div",{className:i.labeledSectionTitle,children:"Actions Details"}),e.jsx("div",{className:i.labeledSectionContent,children:e.jsx(nt,{actions:t.outActions,contracts:s,contractAddress:t.address?.toString()??"",onContractClick:n})})]}),e.jsxs("div",{className:i.detailRow,children:[e.jsx("div",{className:i.detailLabel,children:"Time"}),e.jsx("div",{className:`${i.detailValue} ${i.timestampValue}`,children:Ne(t.transaction.now)})]})]}),o&&g&&e.jsx("div",{className:i.traceViewerContainer,children:e.jsx(at,{tx:t,contracts:s,inline:!0})})]})}const Mn="_traceViewWrapper_1lx4p_1",Bn="_appContainer_1lx4p_7",Ln="_headerContent_1lx4p_17",Fn="_errorMessage_1lx4p_116",Dn="_downloadButton_1lx4p_121",En="_uploadButton_1lx4p_134",An="_downloaded_1lx4p_154",Pn="_uploaded_1lx4p_155",On="_error_1lx4p_116",Rn="_headerControls_1lx4p_180",Hn="_fullPageState_1lx4p_206",Wn="_examplesContainer_1lx4p_211",Un="_examplesTitle_1lx4p_217",Jn="_examplesList_1lx4p_222",B={traceViewWrapper:Mn,appContainer:Bn,headerContent:Ln,errorMessage:Fn,downloadButton:Dn,uploadButton:En,downloaded:An,uploaded:Pn,error:On,headerControls:Rn,fullPageState:Hn,examplesContainer:Wn,examplesTitle:Un,examplesList:Jn},zn=({rawData:t})=>{const[s,n]=h.useState(!1),a=`${B.downloadButton} ${s?B.downloaded:""}`,o=h.useCallback(()=>{const c=JSON.stringify(t,null,2),r=new Blob([c],{type:"application/json"}),l=URL.createObjectURL(r),p=t.at(0)?.testName??"unknown-test",u=document.createElement("a");u.href=l,u.download=`sandbox-${p}-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l),n(!0),setTimeout(()=>n(!1),1e3)},[t]);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{onClick:o,title:s?"Downloaded!":"Download test data as JSON",className:a,"aria-label":s?"Test data downloaded":"Download test data as JSON",children:s?e.jsx(Se,{size:16,"aria-hidden":"true"}):e.jsx(He,{size:16,"aria-hidden":"true"})}),e.jsx("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:s&&"Test data downloaded as JSON file"})]})},qn="_container_g01uo_1",Kn="_header_g01uo_5",Gn="_titleRow_g01uo_11",Xn="_titleSection_g01uo_18",Yn="_collapseButton_g01uo_31",Zn="_testTitle_g01uo_57",Qn="_timestamp_g01uo_64",ea="_stats_g01uo_72",ta="_statItem_g01uo_81",sa="_statLabel_g01uo_87",A={container:qn,header:Kn,titleRow:Gn,titleSection:Xn,collapseButton:Yn,testTitle:Zn,timestamp:Qn,stats:ea,statItem:ta,statLabel:sa};function Ce({testData:t,testIndex:s,rawTestData:n}){const[a,o]=h.useState(!1),c=u=>u?new Date(u).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"",r=t.transactions.length,p=t.transactions.filter(u=>!u.parent).length;return e.jsxs("div",{className:A.container,children:[e.jsxs("div",{className:A.header,children:[e.jsxs("div",{className:A.titleRow,children:[e.jsxs("div",{className:A.titleSection,children:[e.jsxs("h2",{className:A.testTitle,children:["#",s," ",t.testName]}),e.jsx(zn,{rawData:n??[]})]}),e.jsx("button",{className:A.collapseButton,onClick:()=>o(!a),"aria-label":a?"Expand test info":"Collapse test info",children:a?e.jsx(ht,{}):e.jsx(pt,{})})]}),!a&&e.jsxs(e.Fragment,{children:[t.timestamp&&e.jsxs("p",{className:A.timestamp,children:["Executed at: ",c(t.timestamp)]}),e.jsxs("div",{className:A.stats,children:[e.jsxs("span",{className:A.statItem,children:[e.jsx("span",{className:A.statLabel,children:"Total transactions:"})," ",r]}),p>1&&e.jsxs("span",{className:A.statItem,children:[e.jsx("span",{className:A.statLabel,children:"Transaction sequences:"})," ",p]}),e.jsxs("span",{className:A.statItem,children:[e.jsx("span",{className:A.statLabel,children:"Contracts:"})," ",t.contracts.size]})]})]})]}),!a&&e.jsx(ys,{testData:t},`tree-${t.testName}`)]})}const Ie=[{key:"tolk-counter",label:"Tolk: Counter",file:"tolk-sandbox-Counter should reset counter-2025-08-07T20-11-27.json"},{key:"tact-proofs",label:"Tact: Proofs TEP89",file:"tact-sandbox-Proofs TEP89 proof should correctly work for discoverable jettons-2025-08-08T08-23-05.json"}];function na(t){const s=t.trim().toLowerCase();return Ie.find(n=>n.key===s)}function aa(t){return`https://i582.github.io/TxTracer/assets/sandbox-examples/${encodeURIComponent(t)}`}async function Ve(t){const s=aa(t),n=await fetch(s);if(!n.ok)throw new Error(`Failed to fetch example: ${n.status}`);return await n.json()}async function oa(t){const s=na(t);if(s)return Ve(s.file)}const ia=({onDataLoaded:t})=>{const[s,n]=h.useState(null),[a,o]=h.useState(null),c=h.useCallback(async r=>{o(null),n(r);try{const l=await Ve(r);t(l)}catch(l){console.error(l),o(r)}finally{n(null)}},[t]);return e.jsxs("div",{className:B.examplesContainer,children:[e.jsx("span",{className:B.examplesTitle,children:"Or try examples:"}),e.jsx("div",{className:B.examplesList,children:Ie.map(r=>{const l=`?example=${encodeURIComponent(r.key)}`,p=s===r.file,u=a===r.file;return e.jsx("a",{href:l,onClick:v=>v.stopPropagation(),children:e.jsx(ae,{className:`${B.uploadButton} ${u?B.error:p?B.uploaded:""}`,title:`Load example: ${r.label}`,"aria-label":`Load example: ${r.label}`,onClick:()=>void c(r.file),children:p?"Loading...":u?"Error":r.label})},r.file)})})]})},la="_container_qa4t2_1",ra="_fields_qa4t2_7",ca="_label_qa4t2_13",da="_labelText_qa4t2_19",ma="_input_qa4t2_24",G={container:la,fields:ra,label:ca,labelText:da,input:ma};function ua({host:t,port:s,onChange:n}){const[a,o]=h.useState(t),[c,r]=h.useState(s);return h.useEffect(()=>o(t),[t]),h.useEffect(()=>r(s),[s]),e.jsx("div",{className:G.container,title:"WebSocket daemon connection settings",children:e.jsxs("div",{className:G.fields,children:[e.jsxs("label",{className:G.label,children:[e.jsx("span",{className:G.labelText,children:"Host:"}),e.jsx("input",{className:G.input,value:a,onChange:l=>{const p=l.target.value;o(p);const u=p.trim();u.length>0&&n({host:u,port:c})},placeholder:"localhost","aria-label":"Daemon host"})]}),e.jsxs("label",{className:G.label,children:[e.jsx("span",{className:G.labelText,children:"Port:"}),e.jsx("input",{className:G.input,value:c,onChange:l=>{const u=l.target.value.replace(/[^0-9]/g,"");r(u),u.length>0&&n({host:a,port:u})},placeholder:"7743","aria-label":"Daemon port"})]})]})})}const ha="_container_3xbd7_1",pa="_content_3xbd7_8",xa="_leftColumn_3xbd7_14",fa="_rightColumn_3xbd7_25",_a="_title_3xbd7_41",ja="_description_3xbd7_49",ga="_infoSection_3xbd7_57",ba="_infoTitle_3xbd7_64",va="_infoIcon_3xbd7_74",Na="_infoText_3xbd7_81",Ca="_stepsTitle_3xbd7_88",ya="_steps_3xbd7_88",Sa="_step_3xbd7_88",Ta="_stepNumber_3xbd7_120",wa="_stepContent_3xbd7_136",Ia="_stepTitle_3xbd7_141",Va="_stepDescription_3xbd7_148",ka="_codeBlock_3xbd7_155",$a="_codeBlockWrapper_3xbd7_169",Ma="_copyBtn_3xbd7_173",Ba="_inlineCode_3xbd7_201",j={container:ha,content:pa,leftColumn:xa,rightColumn:fa,title:_a,description:ja,infoSection:ga,infoTitle:ba,infoIcon:va,infoText:Na,stepsTitle:Ca,steps:ya,step:Sa,stepNumber:Ta,stepContent:wa,stepTitle:Ia,stepDescription:Va,codeBlock:ka,codeBlockWrapper:$a,copyBtn:Ma,inlineCode:Ba};function La({onLoadExample:t,host:s="localhost",port:n="8081",onChange:a}){return e.jsx("div",{className:j.container,children:e.jsxs("div",{className:j.content,children:[e.jsxs("div",{className:j.leftColumn,children:[e.jsx("h1",{className:j.title,children:"Sandbox Not Connected"}),e.jsx("p",{className:j.description,children:"To work with Sandbox, please follow the setup instructions on the right."}),t&&e.jsx(ia,{onDataLoaded:t}),e.jsxs("div",{className:j.infoSection,children:[e.jsxs("h3",{className:j.infoTitle,children:[e.jsx("span",{className:j.infoIcon,"aria-hidden":"true",children:e.jsx(We,{size:18})}),"What is Sandbox UI?"]}),e.jsx("p",{className:j.infoText,children:"Sandbox UI extends the standard TON Sandbox with transaction tracing capabilities, allowing you to visualize and debug smart contract interactions in web interface."})]})]}),e.jsxs("div",{className:j.rightColumn,children:[e.jsx("h2",{className:j.stepsTitle,children:"Setup Instructions"}),e.jsxs("div",{className:j.steps,children:[e.jsxs("div",{className:j.step,children:[e.jsx("div",{className:j.stepNumber,children:"1"}),e.jsxs("div",{className:j.stepContent,children:[e.jsx("h3",{className:j.stepTitle,children:"Install custom sandbox package"}),e.jsxs("p",{className:j.stepDescription,children:["Install development sandbox package and replace usages of"," ",e.jsx("code",{className:j.inlineCode,children:"@ton/sandbox"})," to"," ",e.jsx("code",{className:j.inlineCode,children:"ton-sandbox-dev"})]}),e.jsxs("div",{className:j.codeBlockWrapper,children:[e.jsx("code",{className:j.codeBlock,children:"yarn add ton-sandbox-dev@0.35.46"}),e.jsx(pe,{className:j.copyBtn,value:"yarn add ton-sandbox-dev@0.35.46",title:"Command"})]})]})]}),e.jsxs("div",{className:j.step,children:[e.jsx("div",{className:j.stepNumber,children:"2"}),e.jsxs("div",{className:j.stepContent,children:[e.jsx("h3",{className:j.stepTitle,children:"Configure connection"}),e.jsx("p",{className:j.stepDescription,children:"Set sandbox server host and port if needed:"}),e.jsx(ua,{host:s,port:n,onChange:a??(()=>{})})]})]}),e.jsxs("div",{className:j.step,children:[e.jsx("div",{className:j.stepNumber,children:"3"}),e.jsxs("div",{className:j.stepContent,children:[e.jsx("h3",{className:j.stepTitle,children:"Start the daemon"}),e.jsx("p",{className:j.stepDescription,children:"Open terminal, run the command and reload this page:"}),e.jsxs("div",{className:j.codeBlockWrapper,children:[e.jsx("code",{className:j.codeBlock,children:`./node_modules/.bin/sandbox-server -p ${n}`}),e.jsx(pe,{className:j.copyBtn,value:`./node_modules/.bin/sandbox-server -p ${n}`,title:"Command"})]})]})]}),e.jsxs("div",{className:j.step,children:[e.jsx("div",{className:j.stepNumber,children:"4"}),e.jsxs("div",{className:j.stepContent,children:[e.jsx("h3",{className:j.stepTitle,children:"Change Blockchain in tests"}),e.jsxs("p",{className:j.stepDescription,children:["In your tests, use"," ",e.jsx("code",{className:j.inlineCode,children:"Blockchain.create({ webUI: true })"})]}),e.jsx("div",{className:j.codeBlockWrapper,children:e.jsx("code",{className:j.codeBlock,children:"await Blockchain.create({ webUI: true });"})})]})]}),e.jsxs("div",{className:j.step,children:[e.jsx("div",{className:j.stepNumber,children:"5"}),e.jsxs("div",{className:j.stepContent,children:[e.jsx("h3",{className:j.stepTitle,children:"Run your test"}),e.jsx("p",{className:j.stepDescription,children:"Data will automatically appear here"})]})]})]})]})]})})}const Fa="_container_sx8tl_1",Da="_content_sx8tl_9",Ea="_leftColumn_sx8tl_16",Aa="_rightColumn_sx8tl_26",Pa="_title_sx8tl_36",Oa="_description_sx8tl_44",Ra="_statusSection_sx8tl_52",Ha="_statusTitle_sx8tl_60",Wa="_statusItem_sx8tl_67",Ua="_statusIcon_sx8tl_80",Ja="_tips_sx8tl_98",za="_tip_sx8tl_98",qa="_tipIcon_sx8tl_124",Ka="_tipContent_sx8tl_130",Ga="_tipTitle_sx8tl_134",Xa="_tipText_sx8tl_141",Ya="_inlineCode_sx8tl_148",I={container:Fa,content:Da,leftColumn:Ea,rightColumn:Aa,title:Pa,description:Oa,statusSection:Ra,statusTitle:Ha,statusItem:Wa,statusIcon:Ua,tips:Ja,tip:za,tipIcon:qa,tipContent:Ka,tipTitle:Ga,tipText:Xa,inlineCode:Ya};function Za(){return e.jsx("div",{className:I.container,children:e.jsxs("div",{className:I.content,children:[e.jsxs("div",{className:I.leftColumn,children:[e.jsx("h2",{className:I.title,children:"Waiting for Data"}),e.jsx("p",{className:I.description,children:"Connection established. Waiting for data from running tests..."}),e.jsxs("div",{className:I.statusSection,children:[e.jsx("h3",{className:I.statusTitle,children:"Connection Status"}),e.jsxs("div",{className:I.statusItem,children:[e.jsx(Q,{svg:e.jsx(mt,{}),size:32,className:I.statusIcon}),e.jsx("span",{children:"WebSocket connected"})]}),e.jsxs("div",{className:I.statusItem,children:[e.jsx("div",{className:I.statusIcon,children:e.jsx(lt,{loading:!0,message:""})}),e.jsx("span",{children:"Waiting for test data"})]})]})]}),e.jsx("div",{className:I.rightColumn,children:e.jsxs("div",{className:I.tips,children:[e.jsxs("div",{className:I.tip,children:[e.jsx(Q,{svg:e.jsx(rt,{}),size:24,className:I.tipIcon}),e.jsxs("div",{className:I.tipContent,children:[e.jsx("h3",{className:I.tipTitle,children:"Set webUI: true in your Blockchain.create()"}),e.jsxs("p",{className:I.tipText,children:["Make sure your tests use"," ",e.jsx("code",{className:I.inlineCode,children:"Blockchain.create({ webUI: true })"})]})]})]}),e.jsxs("div",{className:I.tip,children:[e.jsx(Q,{svg:e.jsx(ct,{}),size:24,className:I.tipIcon}),e.jsxs("div",{className:I.tipContent,children:[e.jsx("h3",{className:I.tipTitle,children:"Run Your Tests"}),e.jsx("p",{className:I.tipText,children:"Execute your test suite and data will appear automatically in real-time"})]})]}),e.jsxs("div",{className:I.tip,children:[e.jsx(Q,{svg:e.jsx(dt,{}),size:24,className:I.tipIcon}),e.jsxs("div",{className:I.tipContent,children:[e.jsx("h3",{className:I.tipTitle,children:"Live Updates"}),e.jsx("p",{className:I.tipText,children:"No need to refresh - new transactions will appear as they are executed"})]})]}),e.jsxs("div",{className:I.tip,children:[e.jsx(Q,{svg:e.jsx(ut,{}),size:24,className:I.tipIcon}),e.jsxs("div",{className:I.tipContent,children:[e.jsx("h3",{className:I.tipTitle,children:"Debug Smart Contracts"}),e.jsx("p",{className:I.tipText,children:"Trace transactions step-by-step to understand contract execution flow and debug issues"})]})]})]})})]})})}function Qa({url:t="ws://localhost:7743",onError:s}={}){const[n,a]=h.useState([]),[o,c]=h.useState(new Map),[r,l]=h.useState(""),[p,u]=h.useState(!1),[v,f]=h.useState(!1),m=h.useCallback(k=>{y(k),f(!0)},[]),x=h.useCallback(()=>{y([]),c(new Map),a([])},[]),[g,y]=h.useState([]);function N(k){try{return JSON.parse(k)}catch{return}}const L=h.useCallback((k,T)=>{T||y(W=>[...W,k]);const J=N(k.transactions);if(!J){console.error("Cannot parse transactions:",k);return}const z=k.testName??"unknown";c(W=>{const K=new Map(W);return K.set(z,k.contracts),K}),a(W=>W.find(U=>U.testName===z)?(console.log("Updating existing test:",z),W.map(U=>U.testName===z?{...U,transactions:{transactions:[...U.transactions.transactions,...J.transactions]},changes:[...U.changes,...k.changes]}:U)):(console.log("Creating new test:",z),[...W,{testName:z,transactions:J,timestamp:Date.now(),changes:k.changes}]))},[]),w=h.useCallback(k=>{const T=JSON.parse(k.data);switch(T.$){case"test-data":L(T,!1);break;default:console.warn("Unknown message type:",T)}},[L]),H=h.useCallback(k=>{switch(k.$){case"test-data":L(k,!0);break;default:console.warn("Unknown message type:",k)}},[L]);return h.useEffect(()=>{if(v)for(const k of g)H(k)},[H,v,g]),h.useEffect(()=>{const k=new WebSocket(t);return k.onopen=()=>{l(""),u(!0)},k.onmessage=w,k.onerror=()=>{const T="Cannot connect to the daemon. Run: yarn daemon";l(T),u(!1),s?.(T)},k.onclose=()=>{u(!1)},()=>{k.close()}},[t,w,s]),{tests:n,contractsByTest:o,error:r,isConnected:p,rawData:g,loadFromFile:m,clearFileData:x}}const eo=t=>{if(t!==void 0)try{return $.beginCell().storeUint(4,3).storeUint(0,8).storeUint(t,256).asSlice().loadAddress()}catch{return}};function to(t){const s=t.inMessage,n=s?.info?.type==="internal"?s.info.bounced:!1;let a;const o=s?.body?.asSlice();return o&&(n&&o.loadUint(32),o.remainingBits>=32&&(a=o.loadUint(32))),a}function so(t){return t.inMessage?.info?.type==="internal"?{}:{}}const de=(t,s,n)=>{const a=n.get(t);if(a)return a;const o=t.parsedTransaction??$.loadTransaction($.Cell.fromHex(t.transaction).asSlice()),c=eo(o.address),{computeInfo:r,amount:l,money:p}=io(t),{outActions:u,c5:v}=no(t.fields.vmLogs),f={address:c,transaction:o,fields:t.fields,parent:void 0,opcode:to(o),computeInfo:r,money:p,amount:l,outActions:u,c5:v,data:so(o),children:[]};n.set(t,f);const m=s.find(x=>x.parsedTransaction?.lt.toString()===t.parentId);return f.parent=m?de(m,s,n):void 0,f.children=t.childrenIds.map(x=>s.find(g=>g.parsedTransaction?.lt.toString()===x)).filter(x=>x!==void 0).map(x=>de(x,s,n)),f},no=t=>{let s=[],n;if(!t)return{outActions:s,c5:n};for(const a of t.split(`
`))if(a.startsWith("final c5:")){const[o,c]=ao(a);s=o,n=c}return{outActions:s,c5:n}},ao=t=>{const s=Buffer.from(t.slice(12,-1),"hex"),n=$.Cell.fromBoc(s)[0],a=n.beginParse();return[$.loadOutList(a),n]},oo=t=>{let s=0n;for(const n of t.outMessages.values())n.info.type==="internal"&&(s+=n.info.value.coins);return s},io=t=>{const s=$.loadTransaction($.Cell.fromHex(t.transaction).asSlice());if(!s.inMessage)throw new Error("No in_message was found in result tx");const n=s.inMessage.info.type==="internal"?s.inMessage.info.value.coins:void 0,a=oo(s),o=s.totalFees.coins;if(s.description.type!=="generic")throw new Error("TxTracer doesn't support non-generic transaction. Given type: "+s.description.type);const c=s.description.computePhase,r=c.type==="skipped"?"skipped":{success:c.success,exitCode:c.exitCode===0?s.description.actionPhase?.resultCode??0:c.exitCode,vmSteps:c.vmSteps,gasUsed:c.gasUsed,gasFees:c.gasFees},l=s.inMessage.info.type==="internal"?s.inMessage.info.forwardFee:0n;return{money:{sentTotal:a,totalFees:o,forwardFee:l},amount:n,computeInfo:r}},lo=t=>t.map(s=>de(s,t,new Map));function ke(t){return t.stateInit?$.loadStateInit($.Cell.fromHex(t.stateInit).asSlice()):void 0}function ro(t,s){return t.find(n=>ke(n)?.code?.toBoc()?.toString("hex")===s?.toBoc()?.toString("hex"))}function ye(t){if(t.meta?.treasurySeed)return t.meta?.treasurySeed;if(t.meta?.wrapperName)return t.meta?.wrapperName}function co(t,s){const n=ye(t);if(n)return n;const o=ke(t)?.code;if(o){const c=ro(s,o);if(c){const r=ye(c);if(r)return r}}return"Unknown Contract"}function mo(t={}){const s=Qa(t),n=h.useMemo(()=>{const o=new Map;for(const c of s.rawData)c.testName&&o.set(c.testName,c);return o},[s.rawData]);return{tests:h.useMemo(()=>s.tests.map(o=>{const c=o.transactions.transactions.map(f=>({...f,transaction:f.transaction,parsedTransaction:$.loadTransaction($.Cell.fromHex(f.transaction).asSlice())})),r=lo(c),l=o.testName??"unknown",p=s.contractsByTest.get(l)??[],u=p.map((f,m)=>{const x=$.Address.parse(f.address),g=String.fromCharCode(65+m%26),y=co(f,p);return{...f,address:x,stateInit:f.stateInit?$.loadStateInit($.Cell.fromHex(f.stateInit).asSlice()):void 0,account:$.loadShardAccount($.Cell.fromHex(f.account).asSlice()),letter:g,displayName:y,kind:f.meta?.treasurySeed!==void 0?"treasury":"user-contract"}}),v=new Map(u.map(f=>[f.address.toString(),f]));return{testName:o.testName,transactions:r,timestamp:o.timestamp,contracts:v,changes:o.changes}}),[s.tests,s.contractsByTest]),error:s.error,isConnected:s.isConnected,isSharedData:s.rawData.length>0,rawData:s.rawData,rawDataByTest:n,clearFileData:s.clearFileData,loadFromFile:s.loadFromFile}}const re=({onDataLoaded:t})=>{const[s,n]=h.useState("idle"),a=h.useRef(null),o=`${B.uploadButton} ${s==="success"?B.uploaded:s==="error"?B.error:""}`,c=h.useCallback(u=>{const v=u.target.files?.[0];if(!v)return;const f=new FileReader;f.onload=()=>{try{const m=f.result,x=JSON.parse(m);t(x),n("success"),setTimeout(()=>n("idle"),2e3)}catch(m){console.error("Error parsing uploaded file:",m),n("error"),setTimeout(()=>n("idle"),3e3)}},f.onerror=()=>{n("error"),setTimeout(()=>n("idle"),3e3)},f.readAsText(v),u.target.value=""},[t]),r=h.useCallback(()=>{a.current?.click()},[]),l=()=>{switch(s){case"success":return"Loaded!";case"error":return"Error";default:return"Upload"}},p=()=>{switch(s){case"success":return e.jsx(Se,{size:16,"aria-hidden":"true"});case"error":return e.jsx(Je,{size:16,"aria-hidden":"true"});default:return e.jsx(Ue,{size:16,"aria-hidden":"true"})}};return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:a,type:"file",accept:".json",onChange:c,style:{display:"none"},"aria-label":"Upload test data JSON file"}),e.jsxs(ae,{onClick:r,title:"Upload test data from JSON file",className:o,"aria-label":"Upload test data from JSON file",children:[p(),l()]}),e.jsxs("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:[s==="success"&&"Test data loaded successfully",s==="error"&&"Error loading test data file"]})]})};function uo(){const[t,s]=te.useState(()=>{if(typeof window<"u"){const x=(localStorage.getItem("sandbox-daemon-host")??"").trim();return x.length?x:"localhost"}return"localhost"}),[n,a]=te.useState(()=>{if(typeof window<"u"){const x=(localStorage.getItem("sandbox-daemon-port")??"").replace(/[^0-9]/g,"");return x.length?x:"7743"}return"7743"}),o=te.useMemo(()=>`ws://${t}:${n}`,[t,n]),{tests:c,error:r,isConnected:l,isSharedData:p,rawData:u,loadFromFile:v}=mo({url:o});if(h.useEffect(()=>{const x=new URLSearchParams(window.location.search).get("example");x&&oa(x).then(g=>{g&&v(g)})},[v]),p)return e.jsxs("div",{className:B.traceViewWrapper,children:[e.jsx(le,{pageTitle:"sandbox",titleBadgeText:"Alpha",titleBadgeColor:"green",children:e.jsx("div",{className:B.headerContent,children:e.jsx("div",{className:B.headerControls,children:e.jsx(re,{onDataLoaded:v})})})}),e.jsx("main",{className:B.appContainer,children:c.map((m,x)=>e.jsx(Ce,{testData:m,testIndex:x+1,rawTestData:u.filter(g=>g.testName===m.testName)},m.testName))})]});const f=e.jsx(le,{pageTitle:"sandbox",titleBadgeText:"Alpha",titleBadgeColor:"green",children:e.jsx("div",{className:B.headerContent,children:e.jsx("div",{className:B.headerControls,children:e.jsx(re,{onDataLoaded:v})})})});return l?l&&c.length===0&&!r?e.jsxs("div",{className:B.traceViewWrapper,children:[f,e.jsx("div",{className:B.fullPageState,children:e.jsx(Za,{})})]}):e.jsxs("div",{className:B.traceViewWrapper,children:[e.jsx(le,{pageTitle:"sandbox",titleBadgeText:"Alpha",titleBadgeColor:"blue",children:e.jsx("div",{className:B.headerContent,children:e.jsx("div",{className:B.headerControls,children:e.jsx(re,{onDataLoaded:v})})})}),e.jsxs("main",{className:B.appContainer,children:[r&&e.jsx("div",{className:B.errorMessage,children:r}),e.jsx("div",{children:c.map((m,x)=>e.jsx(Ce,{testData:m,testIndex:x+1,rawTestData:u.filter(g=>g.testName===m.testName)},m.testName))})]})]}):e.jsxs("div",{className:B.traceViewWrapper,children:[f,e.jsx("div",{className:B.fullPageState,children:e.jsx(La,{onLoadExample:v,host:t,port:n,onChange:({host:m,port:x})=>{const g=m.trim()??"localhost",y=(x??"").replace(/[^0-9]/g,"")??"7743";s(g),a(y),typeof window<"u"&&(localStorage.setItem("sandbox-daemon-host",g),localStorage.setItem("sandbox-daemon-port",y))}})})]})}ze.createRoot(document.getElementById("root")).render(e.jsx(te.StrictMode,{children:e.jsx(qe,{children:e.jsx(Ke,{children:e.jsx(Ge,{children:e.jsx(Xe,{loadingMessage:"Loading Sandbox page...",children:e.jsx(uo,{})})})})})}));
